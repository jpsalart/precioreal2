<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PrecioReal · Escanea y abre en Amazon</title>
  <meta name="description" content="Escanea EAN/UPC/ISBN, encuentra el ASIN y abre la ficha en Amazon con tu enlace de afiliado.">
  <meta name="theme-color" content="#0b0f14">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32.png">

  <style>
    /* =====================================================
       PrecioReal · Propuesta de Diseño (solo UI / arte)
       - 100% additivo, no rompe IDs/clases ni lógica
       - Mobile-first, dark por defecto, AA
       ===================================================== */

    /* Paleta base ya existente (respetada) */
    :root{ --bg:#0b0f14; --panel:#121824; --text:#e7edf7; --muted:#a8b3c7; --brand:#3aa1ff; --brand2:#1e78d5; --bd:#1a2434; --ok:#9fe29f; --bad:#ffb3b3; }

    /* Tokens extendidos (no destructivos) */
    :root{
      --surface:#0d1423;
      --ring:#7cc8ff;           /* foco accesible */
      --ring-strong:#9fe2ff;    /* foco alto contraste */
      --brand-600:#2e91f0;
      --brand-700:#1e78d5;
      --ok-700:#74d774;
      --warn:#ffd27a;
      --error:#ff7a7a;

      /* Tipografía fluida */
      --fs-h1: clamp(18px, 2vw, 22px);
      --fs-h2: clamp(16px, 1.8vw, 20px);
      --fs-body: clamp(14px, 1.6vw, 16px);
      --fs-small: clamp(12px, 1.4vw, 13px);

      /* Radios y sombras */
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 14px;
      --shadow-1: 0 6px 18px rgba(0,0,0,.28), 0 1px 0 rgba(255,255,255,.02) inset;
      --shadow-2: 0 10px 24px rgba(0,0,0,.36);
    }

    /* Reset mínimo y base tipográfica */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--bg);color:var(--text);font-size:var(--fs-body)}

    .wrap{max-width:820px;margin:0 auto;padding:16px}

    /* Header */
    header{display:flex;align-items:center;gap:12px;padding:16px 0;border-bottom:1px solid var(--bd)}
    .logo{width:40px;height:40px;border-radius:10px;display:grid;place-items:center;background:linear-gradient(135deg,var(--brand),#7cc8ff);color:#041423;font-weight:900}
    h1{font-size:var(--fs-h1);margin:0}
    .muted{color:var(--muted)}

    /* Panel contenedor */
    .panel{background:var(--panel);border:1px solid var(--bd);border-radius:14px;padding:14px;margin:16px 0}
    .bar{display:flex;justify-content:space-between;align-items:center;margin:8px 0 4px 0}
    .bar .title{font-size:var(--fs-h2);font-weight:900}

    /* Controles y campos */
    .row{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .row input{flex:1;min-width:180px;padding:12px;border-radius:12px;border:1px solid #223352;background:#0c1322;color:#e7edf7}

    /* Botones base (respetando .btn) */
    .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 14px;border-radius:12px;border:0;cursor:pointer;background:linear-gradient(180deg,#2a72c7,#1d5ba7);color:#fff;font-weight:800;box-shadow: 0 1px 0 rgba(255,255,255,.06) inset;transition: transform .08s ease, box-shadow .2s ease, opacity .2s ease}
    .btn:hover{ filter:saturate(1.05) }
    .btn:active{ transform: translateY(1px) scale(.99) }
    .btn[disabled]{opacity:.55;cursor:not-allowed}
    .btn.secondary{background:#182339;color:var(--text);border:1px solid #223352}
    .btn.secondary:hover{ border-color:#2b4166; background:#1a2540 }
    .btn.ghost{background:transparent;border:1px dashed #2a3a5a;color:#9bb4d9}
    .btn.ghost:hover{ border-style:solid; border-color:#385584; color:#b8cff0 }

    /* Focus visible accesible unificado */
    :where(button,a,input,textarea,select,.banner):focus-visible{ outline:2px solid var(--ring); outline-offset:2px; border-radius:var(--radius-md) }

    /* Escáner */
    #scanner{position:relative;aspect-ratio:3/2;background:#0d1423;border:1px solid #17243b;border-radius:14px;display:grid;place-items:center;overflow:hidden;margin-top:12px}
    #scanner video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}

    /* Marco de esquinas (no requiere HTML extra) */
    #scanner::after{
      content:""; position:absolute; inset:8px; border-radius:16px; pointer-events:none; opacity:.9;
      background:
        linear-gradient(90deg,var(--brand),var(--brand)) top left/32px 2px no-repeat,
        linear-gradient(0deg ,var(--brand),var(--brand)) top left/2px 32px no-repeat,
        linear-gradient(90deg,var(--brand),var(--brand)) top right/32px 2px no-repeat,
        linear-gradient(0deg ,var(--brand),var(--brand)) top right/2px 32px no-repeat,
        linear-gradient(90deg,var(--brand),var(--brand)) bottom left/32px 2px no-repeat,
        linear-gradient(0deg ,var(--brand),var(--brand)) bottom left/2px 32px no-repeat,
        linear-gradient(90deg,var(--brand),var(--brand)) bottom right/32px 2px no-repeat,
        linear-gradient(0deg ,var(--brand),var(--brand)) bottom right/2px 32px no-repeat;
    }

    /* Barrido sutil (decorativo) */
    #scanner::before{ content:""; position:absolute; left:0; top:-100%; width:100%; height:40%; pointer-events:none; background: linear-gradient(180deg, rgba(255,255,255,0), rgba(124,200,255,.06), rgba(255,255,255,0)); animation: pr-sweep 2.2s linear infinite }
    @keyframes pr-sweep{ to{ transform: translateY(200%) } }

    /* Flash de confirmación al leer (añadido desde JS) */
    @keyframes pr-scan-flash{ 0%{ box-shadow: 0 0 0 0 rgba(124,200,255,.55) inset } 100%{ box-shadow: 0 0 0 10px rgba(124,200,255,0) inset } }
    #scanner.flash::after{ animation: pr-scan-flash .35s ease-out }

    /* Overlay informativo dentro del escáner */
    #overlay{position:absolute;left:8px;right:8px;bottom:8px;background:linear-gradient(0deg, rgba(0,0,0,.55), rgba(0,0,0,.38));backdrop-filter:blur(6px);border:1px solid #274065;border-radius:10px;padding:6px 8px;font-size:12px;color:#cfe7ff;white-space:pre-line}

    .hint{font-size:12px;color:#9bb4d9;margin-top:6px}

    /* CTA Amazon (banner) */
    .banner{display:flex;align-items:center;gap:10px;background:linear-gradient(180deg,#7cc8ff,#3aa1ff);border-radius:12px;padding:12px;border:1px solid #284463;color:#06121f;font-weight:800;box-shadow:var(--shadow-1);transition: transform .08s ease, box-shadow .2s ease, opacity .2s}
    .banner:hover{ transform: translateY(-1px); box-shadow:var(--shadow-2) }
    .banner:active{ transform: translateY(0) }
    .banner.disabled{ opacity:.55; pointer-events:none; filter:grayscale(.25) }
    .banner .title{font-size:16px}

    /* Histórico: tarjetas */
    .list-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px}
    .mini{position:relative;display:grid;grid-template-columns:74px 1fr;gap:10px;padding:10px;border-radius:12px;border:1px solid var(--bd);background:#0d1423;box-shadow: 0 1px 0 rgba(255,255,255,.02) inset, 0 0 0 1px rgba(26,36,52,.6);transition: box-shadow .2s ease, transform .08s ease, border-color .2s ease}
    .mini:hover{ box-shadow: 0 2px 0 rgba(255,255,255,.02) inset, 0 8px 20px rgba(0,0,0,.35); transform: translateY(-1px) }
    .mini .thumb{width:74px;height:74px;border-radius:10px;display:grid;place-items:center;background:#0f1728}
    .mini .title{font-weight:900;font-size:16px;line-height:1.25;margin:2px 0 4px}
    .mini .meta{font-size:12px;color:#8fa9cd}
    .mini .cta{display:flex;gap:6px;margin-top:8px}
    .icon-btn,.star{position:absolute;top:6px;display:grid;place-items:center;background:#172033;border:1px solid #24344f;cursor:pointer;font-weight:900;transition: transform .08s ease, background .2s ease}
    .icon-btn{left:6px;width:36px;height:36px;border-radius:8px}
    .star{right:6px;width:38px;height:38px;border-radius:12px;font-size:20px}
    .star.off{color:#b0b0b0}

    /* Chips/Badges utilitarias */
    .chip{display:inline-flex;align-items:center;gap:6px;background:#16253c;border:1px solid #243559;border-radius:999px;padding:3px 8px;font-size:12px;color:#9bb4d9}
    .chip .dot{width:10px;height:10px;border-radius:999px;background:linear-gradient(180deg,var(--brand),var(--brand2))}

    /* Skeleton utilitario */
    .skeleton{ position:relative; overflow:hidden; background:#101a2c; border-radius:10px; }
    .skeleton::after{ content:""; position:absolute; inset:0; background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.06), rgba(255,255,255,0)); transform: translateX(-100%); animation: pr-skel 1.2s infinite }
    @keyframes pr-skel{ to{ transform: translateX(100%) } }

    /* Toasts (éxito/error/info) */
    .toast{ position:fixed; left:50%; bottom:16px; transform:translate(-50%, 16px); min-width:220px; max-width:90vw; padding:12px 14px; border-radius:12px; border:1px solid #223352; background:#0e1628; color:var(--text); font-weight:700; box-shadow:var(--shadow-1); opacity:0; pointer-events:none; transition:opacity .2s ease, transform .2s ease }
    .toast.show{ opacity:1; transform:translate(-50%, 0); pointer-events:auto }
    .toast.ok{ border-color:#2b5340 }
    .toast.warn{ border-color:#6b5a2b }
    .toast.err{ border-color:#5a2b2b }

    /* Footer */
    footer{margin:18px 0 8px;border-top:1px solid var(--bd);padding-top:12px;color:#a8b3c7;font-size:0.95rem;line-height:1.35}

    /* Modo light opcional (mantiene tokens) */
    @media (prefers-color-scheme: light){
      :root{ --bg:#f7f9fc; --panel:#ffffff; --text:#0b1526; --muted:#4a5a78; --bd:#dfe6f2 }
      body{ background:var(--bg); color:var(--text) }
      .panel{ background:var(--panel); border-color:var(--bd) }
      .mini{ background:#fff }
      #scanner{ background:#eef3fb; border-color:#c8d7f0 }
    }

    /* Accesibilidad: reducir movimiento */
    @media (prefers-reduced-motion: reduce){
      *{ animation: none !important; transition: none !important }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">PR</div>
      <div>
        <h1>PrecioReal <span class="muted">· Escanea y abre en Amazon</span></h1>
        <div class="muted">PWA ligera, móvil-first. No mostramos precios de Amazon (cumplimiento).</div>
      </div>
    </header>

    <!-- Bloque: Escáner -->
    <section class="panel" aria-labelledby="scan-title">
      <div class="bar"><div id="scan-title" class="title">Escáner</div></div>
      <div class="row" role="group" aria-label="Controles de cámara">
        <button id="btnScan" class="btn" type="button">📷 Abrir cámara</button>
        <button id="btnFlash" class="btn secondary" type="button">🔦 Linterna</button>
        <button id="btnStop" class="btn ghost" type="button">⏹️ Parar</button>
      </div>

      <div id="scanner" aria-live="polite">
        <video id="video" autoplay muted playsinline></video>
        <div id="overlay">Permite la cámara para escanear códigos.
• Mantén el móvil estable y a 15–25 cm.
• Iluminación uniforme.
• Vibra/sonido al detectar.</div>
      </div>
      <div class="hint">También puedes introducir un código manualmente.</div>

      <div class="row" style="margin-top:12px">
        <input id="manual" inputmode="numeric" pattern="[0-9]*" placeholder="Introducir EAN/UPC/ISBN" aria-label="Código manual" />
        <button id="btnGo" class="btn" type="button">➡️ Buscar</button>
      </div>
    </section>

    <!-- Bloque: Resultado / CTA Amazon -->
    <section class="panel" aria-labelledby="res-title">
      <div class="bar"><div id="res-title" class="title">Resultado</div></div>
      <button class="banner" id="amazonCta" type="button" aria-label="Abrir en Amazon con enlace de afiliado">
        <div aria-hidden>🛒</div>
        <div>
          <div class="title">Ver en Amazon</div>
          <div class="muted">Se abrirá con tu enlace de afiliado</div>
        </div>
      </button>
    </section>

    <!-- Bloque: Histórico -->
    <section class="panel" aria-labelledby="hist-title">
      <div class="bar">
        <div id="hist-title" class="title">Histórico</div>
        <div class="chip"><span class="dot"></span>Ultimos escaneos</div>
      </div>

      <div class="list-grid" id="history">
        <!-- Tarjeta de ejemplo (puedes eliminarla) -->
        <article class="mini" role="group" aria-label="Ejemplo de producto">
          <div class="thumb">📦</div>
          <div>
            <div class="title">Ejemplo de producto</div>
            <div class="meta">EAN 1234567890123</div>
            <div class="cta">
              <button class="btn secondary" type="button">📋 Copiar</button>
              <button class="btn ghost" type="button">⭐ Favorito</button>
            </div>
          </div>
          <button class="icon-btn" aria-label="Eliminar">✕</button>
          <button class="star" aria-pressed="false" aria-label="Marcar como favorito">⭐</button>
        </article>

        <!-- Placeholder skeleton -->
        <article class="mini">
          <div class="thumb skeleton"></div>
          <div>
            <div class="title skeleton" style="height:18px;border-radius:6px"></div>
            <div class="meta skeleton" style="height:12px;margin-top:6px;border-radius:6px"></div>
            <div class="cta" style="margin-top:8px">
              <div class="btn secondary skeleton" style="width:90px;height:36px;border-radius:12px"></div>
              <div class="btn ghost skeleton" style="width:120px;height:36px;border-radius:12px"></div>
            </div>
          </div>
        </article>
      </div>
    </section>

    <footer>
      PrecioReal · MVP · Cámara en navegador + enlaces de afiliado · Hecho con cariño 💙
    </footer>
  </div>

  <!-- Toast UI -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // =====================================================
    // UI/arte additivo (no cambia tu lógica existente)
    // - Cámara demo mínima (getUserMedia)
    // - beep() con vibración + flash visual
    // - showToast() para feedback visual
    // =====================================================

    const settings = { noSound:false, noVibra:false };

    async function startCamera(){
      try{
        const video = document.getElementById('video');
        const stream = await navigator.mediaDevices.getUserMedia({ video:{ facingMode:'environment' }, audio:false });
        video.srcObject = stream;
        document.getElementById('overlay').textContent = 'Apunta al código de barras. Sonará/Vibrará al detectar.';
        showToast('Cámara lista', 'ok');
      }catch(err){
        document.getElementById('overlay').textContent = 'No se pudo acceder a la cámara. Revisa permisos.';
        showToast('Permiso de cámara denegado', 'err');
      }
    }

    function stopCamera(){
      const video = document.getElementById('video');
      const s = video.srcObject; if(s){ s.getTracks().forEach(t=>t.stop()); video.srcObject=null; }
      document.getElementById('overlay').textContent = 'Cámara detenida.';
      showToast('Cámara detenida', 'warn');
    }

    function beep(){
      try{
        if (!settings.noSound){
          const ctx=new (window.AudioContext||window.webkitAudioContext)();
          const o=ctx.createOscillator(); const g=ctx.createGain();
          o.frequency.value=880; g.gain.value=0.1; o.connect(g).connect(ctx.destination);
          o.start(); setTimeout(()=>{o.stop();ctx.close();},120);
        }
      }catch(_){ }
      try{ if (!settings.noVibra){ navigator.vibrate && navigator.vibrate(80); } }catch(_){ }
      // Flash visual en el marco de escaneo
      try{ const sc=document.getElementById('scanner'); sc && (sc.classList.add('flash'), setTimeout(()=>sc.classList.remove('flash'), 280)); }catch(_){ }
    }

    // Toast minimalista
    let toastTimer=null;
    function showToast(msg,type){
      const t=document.getElementById('toast');
      t.textContent = msg || '';
      t.className = 'toast show' + (type?(' '+type):'');
      clearTimeout(toastTimer);
      toastTimer=setTimeout(()=>{ t.classList.remove('show'); }, 2500);
    }

    // DEMO: botones
    document.getElementById('btnScan').addEventListener('click', startCamera);
    document.getElementById('btnStop').addEventListener('click', stopCamera);
    document.getElementById('btnGo').addEventListener('click', ()=>{
      beep();
      document.getElementById('overlay').textContent = 'Código manual enviado. (Simulación de flash)';
      showToast('Código enviado', 'ok');
    });
    document.getElementById('amazonCta').addEventListener('click', ()=>{
      beep();
      showToast('Abriendo Amazon…', 'ok');
    });

    // Accesibilidad: evita barrido si reduce motion
    try{
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches){
        const sc = document.getElementById('scanner');
        sc && (sc.style.setProperty('animation','none'), sc.style.setProperty('--sweep','0'));
      }
    }catch(_){ }
  </script>
</body>
</html>
